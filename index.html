<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>修仙模擬 v0.1</title>
    <!-- 外部 CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="faction-overlay" style="
    display:none;
    position:fixed;
    inset:0;
    background:#000;
    z-index:9999;
">
        <!-- 加一個 id="faction-frame" -->
        <iframe id="faction-frame" src="faction.html" style="width:100%; height:100%; border:none;"></iframe>

        <button id="btn-close-faction" style="
        position: absolute;
        top: 14px;
        left: 14px;
        padding: 6px 14px;
        font-size: 13px;
        border: 1px solid rgba(255, 245, 215, 0.55);
        border-radius: 6px;
        cursor: pointer;
        background: linear-gradient(to bottom, rgba(60,40,32,0.9), rgba(30,20,16,0.85));
        color: #f8e9c9;
        letter-spacing: 2px;
        box-shadow: 0 0 6px rgba(0,0,0,0.6), inset 0 0 4px rgba(255,255,255,0.08);
        z-index: 9999;
        backdrop-filter: blur(2px);
    ">
            返回修行界
        </button>

    </div>

    <!-- === 難度選擇彈窗背景 === -->
    <div id="difficulty-modal-bg" style="display:none;"></div>

    <!-- === 難度選擇彈窗 === -->
    <div id="difficulty-modal" style="display:none;">
        <div class="diff-title">選擇你的修行天賦</div>
        <div class="diff-desc">轉世輪迴，天道無常。請選擇此世的資質起點...</div>

        <div class="diff-options">
            <button class="difficulty-btn" data-root="1">
                <span class="btn-title">天靈根</span>
                <span class="btn-sub">單一屬性，修煉極快</span>
            </button>
            <button class="difficulty-btn" data-root="2">
                <span class="btn-title">雙靈根</span>
                <span class="btn-sub">兩種屬性，資質上乘</span>
            </button>
            <button class="difficulty-btn" data-root="3">
                <span class="btn-title">三靈根</span>
                <span class="btn-sub">三種屬性，凡人資質</span>
            </button>
            <button class="difficulty-btn" data-root="4">
                <span class="btn-title">四靈根</span>
                <span class="btn-sub">四種屬性，寸步難行</span>
            </button>
            <button class="difficulty-btn" data-root="5">
                <span class="btn-title">五靈根</span>
                <span class="btn-sub">五行雜駁，幾無仙緣</span>
            </button>
        </div>
    </div>



    <!-- === 靈根測試彈窗 === -->
    <div id="root-test-bg" style="display:none;"></div>
    <div id="root-test-modal" style="display:none;">
        <div class="root-test-header">
            <span>靈根覺醒</span>
        </div>
        <div class="root-test-content">
            <div class="spirit-orb-container">
                <div class="spirit-orb"></div>
                <div class="orb-particles"></div>
            </div>
            <div id="root-roll-result" class="root-roll-result">
                檢測到你的靈魂波動...
            </div>
            <button id="btn-roll-root" class="difficulty-btn diff-roll">開始測試</button>
        </div>
    </div>

    <!-- === 商店彈窗背景 === -->
    <div id="shop-modal-bg" style="display:none;"></div>

    <!-- === 商店彈窗 === -->
    <div id="shop-modal" style="display:none;">
        <div id="shop-modal-header">
            <span>靈寶商店</span>
            <span id="shop-balance"
                style="flex: 1; text-align: right; margin-right: 15px; color: #ffd700; font-size: 14px;">💰 靈石：0</span>
            <button id="shop-close-btn">X</button>
        </div>

        <div id="shop-modal-content">
            <div id="shop-list"></div>
        </div>
    </div>

    <!-- === 飛升結算畫面 === -->
    <div id="ascension-victory-bg" style="display:none;"></div>
    <div id="ascension-victory-modal" style="display:none;">
        <div class="ascension-victory-header">
            <span>✨ 飛升成功 ✨</span>
        </div>
        <div class="ascension-victory-content">
            <div class="victory-section">
                <h3>最終數值</h3>
                <div class="victory-stats" id="victory-final-stats"></div>
            </div>
            <div class="victory-section">
                <h3>修煉歷程</h3>
                <div class="victory-timeline" id="victory-timeline"></div>
            </div>
        </div>
        <button id="victory-close-btn" class="victory-btn">重修此世</button>
    </div>

    <!-- === 遊戲說明彈窗 === -->
    <div id="help-modal-bg" style="display:none;"></div>
    <div id="help-modal" style="display:none;">
        <div class="help-modal-header">
            <span>📖 遊戲說明</span>
            <button id="help-close-btn">X</button>
        </div>
        <div class="help-modal-content">
            <div class="help-section">
                <h3>🎮 遊戲目標</h3>
                <p>從凡人開始修煉，突破各個境界，最終飛升成仙。管理你的資源、選擇合適的功法、加入宗門，在修仙世界中不斷成長。</p>
            </div>

            <div class="help-section">
                <h3>⚡ 基礎操作</h3>
                <ul>
                    <li><strong>閉關修煉：</strong>消耗時間累積真氣，真氣達到上限後可嘗試突破</li>
                    <li><strong>嘗試突破：</strong>當真氣滿足條件時，可嘗試突破到下一境界</li>
                    <li><strong>背包：</strong>查看和使用你獲得的物品、裝備</li>
                    <li><strong>藏寶閣：</strong>使用靈石購買丹藥、裝備等物品</li>
                    <li><strong>歷練：</strong>前往各種地點進行冒險，獲得獎勵</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🌟 靈根系統</h3>
                <p>遊戲開始時會測試你的靈根。靈根決定你的修煉速度和可學習的技能：</p>
                <ul>
                    <li><strong>天靈根（1種）：</strong>修煉最快，但技能選擇有限</li>
                    <li><strong>雙靈根（2種）：</strong>修煉較快，技能選擇適中</li>
                    <li><strong>三靈根（3種）：</strong>凡人資質，修煉速度一般</li>
                    <li><strong>四靈根（4種）：</strong>修煉緩慢</li>
                    <li><strong>五靈根（5種）：</strong>修煉極慢，但可學習所有技能</li>
                </ul>
                <p>五行屬性：金🗡️、木🌿、水💧、火🔥、土🪨</p>
            </div>

            <div class="help-section">
                <h3>🏛️ 宗門系統</h3>
                <p>加入宗門後可以：</p>
                <ul>
                    <li><strong>技藝堂：</strong>學習和升級戰鬥技能</li>
                    <li><strong>藏經閣：</strong>兌換功法和秘籍</li>
                    <li><strong>任務堂：</strong>接取任務賺取貢獻和聲望</li>
                    <li><strong>賭坊：</strong>參與小遊戲（猜大小等）</li>
                    <li><strong>挑戰：</strong>挑戰其他弟子提升位階</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🎨 四藝系統</h3>
                <p>修真百藝包含：</p>
                <ul>
                    <li><strong>煉丹：</strong>製作各種丹藥</li>
                    <li><strong>煉器：</strong>打造裝備和法器</li>
                    <li><strong>陣法：</strong>布置陣法</li>
                    <li><strong>符籙：</strong>製作符咒</li>
                    <li><strong>熔煉：</strong>合成高階材料</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>💡 遊戲提示</h3>
                <ul>
                    <li>注意管理壽元，壽元耗盡會導致坐化</li>
                    <li>突破境界會增加壽元上限</li>
                    <li>合理使用靈石購買丹藥和裝備</li>
                    <li>完成宗門任務可獲得大量貢獻值</li>
                    <li>記得定期存檔！</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="app">
        <!-- ====== 上方標題列 ====== -->
        <div id="header">
            <div>
                🧘‍♂️ 修仙模擬 v0.1
                <button id="btn-help"
                    style="margin-left: 8px; padding: 0; border: 1px solid rgba(255, 245, 215, 0.4); border-radius: 50%; cursor: pointer; background: rgba(60,40,32,0.6); color: #f8e9c9; width: 26px; height: 26px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease;"
                    onmouseover="this.style.background='rgba(80,60,42,0.8)'"
                    onmouseout="this.style.background='rgba(60,40,32,0.6)'">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </button>
            </div>
            <div id="header-info"></div>
        </div>

        <!-- ====== 左側：角色資訊 ====== -->
        <div id="left-panel">
            <!-- 角色資訊 -->
            <details class="info-section" open>
                <summary>角色資訊</summary>
                <div class="stat-line"><span class="stat-label">姓名：</span><span id="s-name"></span></div>
                <div class="stat-line"><span class="stat-label">年齡：</span><span id="s-age"></span> 歲</div>
                <div class="stat-line"><span class="stat-label">剩餘壽元：</span><span id="s-lifespan"></span> 歲</div>
                <div class="stat-line"><span class="stat-label">境界：</span><span id="s-realm"></span></div>
            </details>

            <!-- 屬性 -->
            <details class="info-section" open>
                <summary>屬性</summary>
                <div class="stat-line">
                    <span class="stat-label">真氣：</span><span id="s-qi"></span>
                </div>
                <div id="break-info-inline" style="font-size:12px; margin-left:6px; color:#ccc;"></div>
                <div class="stat-line">
                    <span class="stat-label">靈氣：</span><span id="s-mana"></span>
                </div>
                <div class="stat-line"><span class="stat-label">悟性：</span><span id="s-comp"></span></div>
                <div class="stat-line"><span class="stat-label">氣運：</span><span id="s-luck"></span></div>
                <div class="stat-line"><span class="stat-label">靈根：</span><span id="s-root"></span></div>
                <div class="stat-line"><span class="stat-label">心境：</span><span id="s-mind"></span></div>
                <div class="stat-line"><span class="stat-label">功法：</span><span id="s-technique"></span></div>
            </details>

            <!-- 戰鬥屬性 -->
            <details class="info-section">
                <summary>戰鬥屬性</summary>
                <div class="stat-line"><span class="stat-label">攻擊力：</span><span id="s-atk"></span></div>
                <div class="stat-line"><span class="stat-label">防禦力：</span><span id="s-def"></span></div>
                <div class="stat-line"><span class="stat-label">身法：</span><span id="s-speed"></span></div>
                <div class="stat-line"><span class="stat-label">暴擊率：</span><span id="s-crit-rate"></span></div>
                <div class="stat-line"><span class="stat-label">暴擊傷害：</span><span id="s-crit-dmg"></span></div>
                <div class="stat-line"><span class="stat-label">血量：</span><span id="s-hp"></span></div>
                <div class="stat-line"><span class="stat-label">屬性攻擊：</span><span id="s-element-atk"></span></div>
                <div class="stat-line"><span class="stat-label">戰力：</span><span id="s-power"></span></div>
            </details>



            <!-- 資源 -->
            <details class="info-section" open>
                <summary>資源</summary>
                <div class="stat-line"><span class="stat-label">靈石：</span><span id="s-stone"></span></div>
            </details>

            <!-- 勢力 -->
            <details class="info-section" open>
                <summary>勢力</summary>
                <div class="stat-line" style="align-items:center;">
                    <span class="stat-label">所屬勢力：</span>
                    <span id="s-faction-name">無</span>
                    <button id="btn-enter-faction" onclick="openFaction();">
                        前往宗門
                    </button>
                </div>
                <div class="stat-line">
                    <span class="stat-label">聲望：</span><span id="s-faction-rep">0</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">位階：</span><span id="s-faction-rank">無</span>
                </div>
                <div class="stat-line">
                    <span class="stat-label">貢獻：</span><span id="s-faction-contrib">0</span>
                </div>
            </details>
        </div>

        <!-- ====== 中間：操作按鈕 ====== -->
        <div id="center-panel">
            <!-- 手機版簡易狀態欄 -->
            <div id="quick-stats" style="display:none;">
                <div class="qs-row">
                    <span id="qs-realm"></span>
                    <span id="qs-rate" style="font-size:0.9em;color:#aaa;"></span>
                </div>
                <!-- 真氣進度條 -->
                <div class="qs-bar-bg">
                    <div id="qs-bar-fill" class="qs-bar-fill"></div>
                    <span id="qs-text" class="qs-bar-text"></span>
                </div>
            </div>

            <h2>修行操作</h2>
            <button id="btn-cultivate-1">閉關修煉 1 年</button>
            <button id="btn-cultivate-10">閉關修煉 10 年</button>
            <button id="btn-cultivate-100" style="display:none;">百年閉關（100 年）</button>
            <button id="btn-breakthrough">嘗試突破</button>
            <button id="btn-ascension" style="display:none;">飛升成仙</button>
            <button id="btn-toggle-arts" style="display:none;">四藝</button>
            <hr style="margin:8px 0; border-color:#444;">
            <button id="btn-toggle-inventory">背包</button>
            <button id="btn-toggle-shop">藏寶閣</button>
            <button id="btn-trial">歷練（暫時試劍山）</button>

            <hr style="margin:8px 0; border-color:#444;">
            <button id="btn-save">存檔（localStorage）</button>
            <button id="btn-load">讀檔</button>
            <button id="btn-reset">重修此世</button>
        </div>

        <!-- ====== 右邊：事件日誌 ====== -->
        <div id="right-panel">
            <h2>修行日誌</h2>
            <div id="log"></div>
        </div>
    </div>

    <!-- === 歷練彈窗背景 === -->
    <div id="trial-modal-bg" style="display:none;"></div>

    <!-- === 歷練彈窗 === -->
    <div id="trial-modal" style="display:none;">
        <div class="trial-header">
            <span>歷練</span>
            <button id="trial-close-btn">X</button>
        </div>

        <!-- 歷練列表視圖（表格式） -->
        <div id="trial-view-list">
            <table class="trial-table">
                <thead>
                    <tr>
                        <th>地點</th>
                        <th>風險</th>
                        <th>說明</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-trial-id="sword_mountain">
                        <td>試劍山</td>
                        <td>中</td>
                        <td>劍意縱橫，適合磨鍊心性與劍道。</td>
                    </tr>
                    <tr data-trial-id="beast_forest">
                        <td>妖獸林</td>
                        <td>高</td>
                        <td>妖獸出沒，危機四伏，但也有不少戰鬥機緣。</td>
                    </tr>
                    <tr data-trial-id="cold_cave">
                        <td>寒潭洞窟</td>
                        <td>中</td>
                        <td>陰寒之地，適合磨練意志，但稍有不慎便會凍傷元氣。</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 劇情視圖（分支選項都在這裡進行） -->
        <div id="trial-view-story" style="display:none;">
            <h3 id="trial-story-title"></h3>
            <div id="trial-story-text" class="trial-story-text"></div>
            <div id="trial-story-choices" class="trial-story-choices"></div>

            <button id="trial-back-btn">返回歷練列表</button>
        </div>
    </div>

    <!-- === 背包彈窗背景 === -->
    <div id="inventory-modal-bg" style="display:none;"></div>

    <!-- === 背包彈窗 === -->
    <div id="inventory-modal" style="display:none;">
        <div id="inventory-modal-header">
            <span>背包</span>
            <button id="inventory-close-btn">X</button>
        </div>

        <div id="inventory-modal-content">
            <!-- 裝備區域 -->
            <div id="inventory-equipment-section"
                style="padding: 10px; background: rgba(0,0,0,0.2); border-bottom: 1px solid #444; margin-bottom: 10px;">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; color: #e0d0b0;">當前裝備</h3>
                <div class="equipment-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <div class="equipment-slot" data-slot="head">
                        <div class="slot-icon">👑</div>
                        <div class="slot-info">
                            <div class="slot-label">頭部</div>
                            <div class="slot-name" id="eq-head">未裝備</div>
                        </div>
                    </div>
                    <div class="equipment-slot" data-slot="body">
                        <div class="slot-icon">👘</div>
                        <div class="slot-info">
                            <div class="slot-label">衣服</div>
                            <div class="slot-name" id="eq-body">未裝備</div>
                        </div>
                    </div>
                    <div class="equipment-slot" data-slot="legs">
                        <div class="slot-icon">👖</div>
                        <div class="slot-info">
                            <div class="slot-label">褲子</div>
                            <div class="slot-name" id="eq-legs">未裝備</div>
                        </div>
                    </div>
                    <div class="equipment-slot" data-slot="feet">
                        <div class="slot-icon">👞</div>
                        <div class="slot-info">
                            <div class="slot-label">鞋子</div>
                            <div class="slot-name" id="eq-feet">未裝備</div>
                        </div>
                    </div>
                    <div class="equipment-slot" data-slot="weapon">
                        <div class="slot-icon">⚔️</div>
                        <div class="slot-info">
                            <div class="slot-label">法器</div>
                            <div class="slot-name" id="eq-weapon">未裝備</div>
                        </div>
                    </div>
                    <div class="equipment-slot" data-slot="formation">
                        <div class="slot-icon">🔮</div>
                        <div class="slot-info">
                            <div class="slot-label">陣法</div>
                            <div class="slot-name" id="eq-formation">未裝備</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="inventory-list"></div>
        </div>
    </div>

    <!-- === 四藝彈窗 === -->
    <div id="arts-modal-bg" class="modal-bg" style="display:none;"></div>
    <div id="arts-modal" class="modal" style="display:none;">
        <div class="modal-header">
            <span>修真百藝</span>
            <button id="arts-close-btn">X</button>
        </div>
        <div class="modal-content">

        </div>
    </div>




    <!-- JS 模組載入順序 -->
    <script src="realms.js"></script>
    <script src="state.js"></script>
    <script src="items.js"></script>
    <script src="root.js"></script>
    <script src="battle.js"></script>
    <script src="events.js"></script>
    <script src="materials.js"></script>
    <script src="trial.js"></script>
    <script src="shop.js"></script>
    <script src="inventory.js"></script>
    <script src="faction.js"></script>
    <script src="trial_rewards.js"></script>
    <script src="sword_mountain.js"></script>
    <script src="contribution.js"></script>
    <script src="arts.js"></script>
    <script src="smelting.js"></script>
    <script src="skills.js"></script>

    <!-- UI Module -->
    <script src="ui.js"></script>
    <!-- Debug mode disabled for production -->
    <!-- <script src="debug.js"></script> -->

    <!-- 手機版底部導航欄 -->
    <div id="mobile-nav">
        <button class="nav-btn" data-target="right-panel">狀態</button>
        <button class="nav-btn active" data-target="center-panel">修煉</button>
        <button class="nav-btn" data-target="left-panel">記錄</button>
    </div>

    <!-- ⭐ main.js 必須最後載入，否則初始化會出錯 -->
    <script src="main.js"></script>
</body>

</html>